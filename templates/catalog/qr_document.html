{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container">
    <div class="section">
        <!-- Breadcrumbs -->
        <nav class="breadcrumbs">
            <a href="{% url 'pages:home' %}" class="breadcrumbs__item">–ì–æ–ª–æ–≤–Ω–∞</a>
            <span class="breadcrumbs__separator">/</span>
            <a href="{% url 'catalog:catalog_list' %}" class="breadcrumbs__item">–ö–∞—Ç–∞–ª–æ–≥</a>
            <span class="breadcrumbs__separator">/</span>
            <a href="{{ product.get_absolute_url }}" class="breadcrumbs__item">{{ product.get_name }}</a>
            <span class="breadcrumbs__separator">/</span>
            <span class="breadcrumbs__current">{{ document.get_title }}</span>
        </nav>

        <div class="card">
            <div class="card-content">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
                <div class="text-center" style="margin-bottom: 2rem;">
                    <h1 class="heading-section">üìÑ {{ document.get_title }}</h1>
                    <p class="text-lead">–î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–¥—É–∫—Ç—É: <strong>{{ product.get_name }}</strong></p>
                </div>

                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç -->
                <div class="tech-specs">
                    <table class="tech-specs__table">
                        <tr class="tech-specs__row">
                            <td class="tech-specs__label">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç—É</td>
                            <td class="tech-specs__value">{{ document.get_document_type_display }}</td>
                        </tr>
                        <tr class="tech-specs__row">
                            <td class="tech-specs__label">–ü—Ä–æ–¥—É–∫—Ç</td>
                            <td class="tech-specs__value">{{ product.get_name }}</td>
                        </tr>
                        <tr class="tech-specs__row">
                            <td class="tech-specs__label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤</td>
                            <td class="tech-specs__value">{{ document.access_count }}</td>
                        </tr>
                        <tr class="tech-specs__row">
                            <td class="tech-specs__label">–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</td>
                            <td class="tech-specs__value">{{ document.created_at|date:"d.m.Y H:i" }}</td>
                        </tr>
                    </table>
                </div>

                <!-- –î—ñ—ó –∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–º -->
                <div class="hero-actions" style="margin-top: 2rem;">
                    {% if document.file %}
                    <a href="{% url 'catalog:download_document' document.id %}" class="btn btn--primary btn--large"
                        onclick="trackDocumentDownload('{{ document.get_title }}')">
                        üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
                    </a>
                    {% endif %}

                    <a href="{{ product.get_absolute_url }}" class="btn btn--secondary btn--large">
                        ‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø—Ä–æ–¥—É–∫—Ç—É
                    </a>
                </div>

                <!-- QR –∫–æ–¥ –¥–ª—è —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É -->
                {% if document.qr_code %}
                <div class="text-center"
                    style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid var(--gray-100);">
                    <h3>–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–º</h3>
                    <p style="margin-bottom: 1rem;">–ü–æ–∫–∞–∂—ñ—Ç—å —Ü–µ–π QR –∫–æ–¥ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:</p>
                    <img src="{{ document.qr_code.url }}" alt="QR –∫–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç—É"
                        style="max-width: 200px; border: 2px solid var(--gray-300); border-radius: var(--radius);">
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –°—Ö–æ–∂—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ —Ü—å–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É -->
        {% if product.documents.count > 1 %}
        <div style="margin-top: 3rem;">
            <h2 class="heading-subsection">–Ü–Ω—à—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ —Ü—å–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É</h2>
            <div class="cards-grid">
                {% for doc in product.documents.all %}
                {% if doc.id != document.id and doc.is_public %}
                <div class="card">
                    <div class="card-content">
                        <h3 class="card-title">üìÑ {{ doc.get_title }}</h3>
                        <p class="card-description">{{ doc.get_document_type_display }}</p>
                        <div class="card-meta">
                            <span style="font-size: 0.9rem; color: var(--gray-600);">
                                –ü–µ—Ä–µ–≥–ª—è–¥—ñ–≤: {{ doc.access_count }}
                            </span>
                            {% if doc.file %}
                            <a href="{% url 'catalog:download_document' doc.id %}" class="btn btn--small">
                                –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
    function trackDocumentDownload(documentName) {
        // –í—ñ–¥—Å—Ç–µ–∂—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
        if (typeof gtag !== 'undefined') {
            gtag('event', 'document_download', {
                'event_category': 'engagement',
                'event_label': documentName,
                'custom_parameter_1': '{{ product.get_name }}'
            });
        }
    }
</script>
{% endblock %}